<div id="lifediv" style='width:500px; margin:0 auto;margin-top:0.5%;'>
<canvas id="lifemap" width="500" height="500" onmousemove="setlives(event)" onmousedown="mouseon(event)" onmouseup="mouseup()"><p>Your browser does not support the canvas element</p></canvas>
<button type="button" class="btn btn-primary btn-lg btn-block" onclick="Start()">Start</button>
</div>

<script>
const speed=100,//ms
      lifeColor='LightSeaGreen',
      mapColor='WhiteSmoke';
var canvas,context,lives,cols,rows;
var gamestarted=0,mouse=0;
window.onload = init;

function init(){
  canvas = document.getElementById("lifemap");
  canvas.style.cssText = "border:1px solid;border-radius:3px;color:SlateGray";
  if(screen.width<500){
    div = document.getElementById("lifediv");
    div.style.cssText = "width:400px; margin:0 auto;margin-top:0.5%;";
    canvas.setAttribute("width", 400);
    canvas.setAttribute("height", 400);
  }
  
  context = canvas.getContext("2d"),
  rows=context.canvas.height/10;
  cols=context.canvas.width/10;
  lives=new Array(rows * cols);
  for(var i=0;i<lives.length;i++){
      lives[i]=0;
  }
  draw(10,10,1,mapColor,lifeColor);
}

function mouseon(evt){
  mouse=1;
  setlives(evt);
}

function mouseup(){
  mouse=0;
}

function setlives(evt){
  if(gamestarted==0 && mouse==1){
     function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        var canvasX=Math.floor((evt.clientX - rect.left)/10);
        if(canvasX>=cols){
          canvasX=cols-1;
        }
        return {
            x: canvasX,
            y: Math.floor((evt.clientY - rect.top)/10)
          };
      }
      var mousePos = getMousePos(canvas, evt);
      lives[mousePos.y*cols+mousePos.x]=1;
      draw(10,10,1,mapColor,lifeColor);
  }
}

function Start()
{
  if(gamestarted==0){
    gamestarted=1;
    gameoflife();
  }
}


function gameoflife(){
  updatelife(10,10,1,mapColor,lifeColor);
  setInterval(updatelife, speed);
}

function updatelife() {
  
  
  draw(10,10,1,mapColor,lifeColor);

  var templive=new Array(lives.length);
  for(var i = 0; i<lives.length; i += 1){
      templive[i]=lives[i];
  }

  for(var y2=0;y2<rows;y2+=1){
      for(var x2=0;x2<cols;x2+=1){
        var lifeCount=0;
        if(y2-1>=0&&x2-1>=0 && templive[(y2-1)*cols+x2-1]>0)lifeCount++;
        if(y2-1>=0 && templive[(y2-1)*cols+x2]>0)lifeCount++;
        if(y2-1>=0&&x2+1<cols && templive[(y2-1)*cols+x2+1]>0)lifeCount++;
        if(x2+1<cols&&templive[y2*cols+x2+1]>0)lifeCount++;
        if(y2+1<rows&&x2+1<cols&&templive[(y2+1)*cols+x2+1]>0)lifeCount++;
        if(y2+1<rows&&templive[(y2+1)*cols+x2]>0)lifeCount++;
        if(y2+1<rows&&x2-1>=0&&templive[(y2+1)*cols+x2-1]>0)lifeCount++;
        if(x2-1>=0&&templive[y2*cols+x2-1]>0)lifeCount++;

        if((lifeCount<2||lifeCount>3)&&templive[y2*cols+x2]>0)lives[y2*cols+x2]=0;
        if(lifeCount==3&&templive[y2*cols+x2]==0)lives[y2*cols+x2]=1;
        }
  }
}

function draw(stepX, stepY, lineWidth, mapColor,lifeColor) {
  context.clearRect(0, 0, context.canvas.width, context.canvas.height);
  context.lineWidth = lineWidth;
  context.strokeStyle = mapColor;
  for(var i = stepY+0.5; i < context.canvas.height; i += stepY){
      context.beginPath();
      context.moveTo(0, i);
      context.lineTo(context.canvas.width, i);
      context.stroke();
  }

  for(var i = stepX+0.5; i < context.canvas.width; i += stepX){
      context.beginPath();
      context.moveTo(i, 0);
      context.lineTo(i, context.canvas.height);
      context.stroke();
  }

  context.fillStyle = lifeColor;
  for(var y=0;y<rows;y++){
      for(var x=0;x<cols;x++){
          if(lives[y*cols+x]==1){
              context.fillRect(x*stepX+1,y*stepY+1,stepX-1,stepY-1);
          }
      }
  }
}
</script>
